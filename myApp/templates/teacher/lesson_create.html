{% extends 'teacher/base.html' %}

{% block content %}
<div class="max-w-3xl mx-auto">
    <!-- Page Header with Back Button -->
    <div class="mb-8 sm:mb-10">
        <a href="{% url 'teacher_lessons' course.id %}" class="inline-flex items-center gap-2 text-sm font-medium text-slate-600 dark:text-slate-300 hover:text-slate-900 dark:hover:text-white transition-colors w-fit mb-6">
            <i class="fas fa-arrow-left"></i>
            <span>Back to Lessons</span>
        </a>
        <div>
            <h1 class="text-3xl sm:text-4xl lg:text-5xl font-extralight text-slate-900 dark:text-slate-50 mb-3 tracking-[-0.02em]">Create Lesson</h1>
            <p class="text-base sm:text-lg text-slate-600 dark:text-slate-300 font-light">Add a new lesson to your course</p>
        </div>
    </div>
    
    <div class="h-px bg-gradient-to-r from-transparent via-slate-200 dark:via-white/10 to-transparent mb-8"></div>
    
    <!-- Form Card -->
    <div class="bg-white dark:bg-white/5 backdrop-blur-xl rounded-2xl border border-slate-200 dark:border-white/10 p-8 sm:p-10 shadow-sm dark:shadow-2xl">
        <form method="post" action="{% url 'teacher_lesson_create' course.id %}" class="space-y-6" id="lessonForm">
            {% csrf_token %}
            
            <!-- Basics Section -->
            <div class="space-y-6">
                <div class="form-section-header">
                    <div class="form-section-icon">
                        <i class="fas fa-info-circle text-emerald-600 dark:text-emerald-400 text-lg"></i>
                    </div>
                    <div class="flex-1">
                        <h2 class="form-section-title">Basics</h2>
                        <p class="form-section-subtitle">Essential lesson information</p>
                    </div>
                </div>
                
                <div class="space-y-6">
                    <div>
                        <label for="module" class="form-label">Module</label>
                        {% if modules %}
                        <select name="module" id="module" required class="form-select">
                            <option value="">-- Select a module --</option>
                            {% for module in modules %}
                            <option value="{{ module.id }}">{{ module.title }}</option>
                            {% endfor %}
                        </select>
                        <p class="form-helper">Select the module this lesson belongs to</p>
                        {% else %}
                        <select name="module" id="module" disabled class="form-select">
                            <option value="">No modules available</option>
                        </select>
                        <p class="form-helper text-amber-600 dark:text-amber-400">
                            <i class="fas fa-exclamation-circle mr-1"></i>
                            No modules yet. Create a module first in the course editor.
                        </p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="title" class="form-label">Title</label>
                        <input type="text" name="title" id="title" required class="form-input" placeholder="Enter lesson title">
                    </div>
                    
                    <div>
                        <label for="description" class="form-label">Description</label>
                        <textarea name="description" id="description" class="form-textarea" rows="4" placeholder="Enter lesson description"></textarea>
                        <p class="form-helper">Provide a brief overview of what students will learn in this lesson</p>
                    </div>
                </div>
            </div>
            
            <!-- Content Section -->
            <div class="space-y-6 pt-6 border-t border-slate-200 dark:border-white/10">
                <div class="form-section-header">
                    <div class="form-section-icon">
                        <i class="fas fa-video text-emerald-600 dark:text-emerald-400 text-lg"></i>
                    </div>
                    <div class="flex-1">
                        <h2 class="form-section-title">Content</h2>
                        <p class="form-section-subtitle">Video and media resources</p>
                    </div>
                </div>
                
                <div>
                    <label for="video_url" class="form-label">Video URL</label>
                    <input type="url" name="video_url" id="video_url" class="form-input" placeholder="https://youtube.com/watch?v=... or https://vimeo.com/...">
                    <p class="form-helper">Paste the URL of your lesson video (YouTube, Vimeo, or other supported platforms)</p>
                </div>
            </div>
            
            <!-- Settings Section -->
            <div class="space-y-6 pt-6 border-t border-slate-200 dark:border-white/10">
                <div class="form-section-header">
                    <div class="form-section-icon">
                        <i class="fas fa-cog text-emerald-600 dark:text-emerald-400 text-lg"></i>
                    </div>
                    <div class="flex-1">
                        <h2 class="form-section-title">Settings</h2>
                        <p class="form-section-subtitle">Display and ordering options</p>
                    </div>
                </div>
                
                <div>
                    <label for="order" class="form-label">Order</label>
                    <input type="number" name="order" id="order" value="0" min="0" class="form-input" placeholder="0">
                    <p class="form-helper">Display order within the module (lower numbers appear first)</p>
                </div>
            </div>
            
            <!-- Submit -->
            <div class="pt-6 border-t border-slate-200 dark:border-white/10">
                <button type="submit" id="submitLessonBtn" class="btn-cta-primary w-full sm:w-auto" {% if not modules %}disabled{% endif %}>
                    <i class="fas fa-plus"></i>
                    Create Lesson
                </button>
                {% if not modules %}
                <p class="mt-2 text-sm text-amber-600 dark:text-amber-400">
                    <i class="fas fa-exclamation-circle mr-1"></i>
                    You must create at least one module before creating lessons.
                </p>
                {% endif %}
            </div>
        </form>
    </div>
</div>

<script>
    // Form validation
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('lessonForm');
        if (form) {
            form.addEventListener('submit', function(e) {
                // Clear previous errors
                document.querySelectorAll('.form-error').forEach(el => el.remove());
                document.querySelectorAll('.border-red-500, .dark\\:border-red-400').forEach(el => {
                    el.classList.remove('border-red-500', 'dark:border-red-400');
                });
                
                const moduleSelect = document.getElementById('module');
                const titleInput = document.getElementById('title');
                let hasErrors = false;
                
                // Validate module selection
                if (!moduleSelect.value || moduleSelect.value === '') {
                    showFieldError('module', 'Please select a module for this lesson.');
                    hasErrors = true;
                }
                
                // Validate title
                if (!titleInput.value.trim()) {
                    showFieldError('title', 'Lesson title is required.');
                    hasErrors = true;
                }
                
                if (hasErrors) {
                    e.preventDefault();
                    const firstError = document.querySelector('.form-error');
                    if (firstError) {
                        firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                    return false;
                }
                
                // Show loading state
                const submitBtn = document.getElementById('submitLessonBtn');
                if (submitBtn) {
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Creating...';
                }
                
                return true;
            });
        }
        
        function showFieldError(fieldId, message) {
            const field = document.getElementById(fieldId);
            if (field) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'form-error text-sm text-red-600 dark:text-red-400 mt-1';
                errorDiv.innerHTML = `<i class="fas fa-exclamation-circle mr-1"></i>${message}`;
                field.parentElement.appendChild(errorDiv);
                field.classList.add('border-red-500', 'dark:border-red-400');
            }
        }
    });
</script>
{% endblock %}
