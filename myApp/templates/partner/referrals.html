{% extends 'partner/base.html' %}

{% block content %}
<div class="w-full space-y-6 sm:space-y-8">
    <div class="mb-6 sm:mb-8">
        <h1 class="text-2xl sm:text-3xl font-bold text-white mb-2">
            Referrals / Sales
        </h1>
        <p class="text-sm sm:text-base text-white/60">
            {% if is_preview_mode %}Platform-wide sales (read-only preview){% else %}Track your referrals, sales, and commissions{% endif %}
        </p>
    </div>
    
    {% if is_preview_mode %}
    <div class="mb-4 p-4 bg-blue-500/20 border border-blue-500/50 rounded-lg">
        <div class="flex items-center gap-2 text-blue-200">
            <i class="fas fa-info-circle"></i>
            <span class="font-medium">Preview Mode: Showing platform-wide sales (read-only)</span>
        </div>
    </div>
    {% endif %}
    
    <!-- Summary Cards -->
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 sm:gap-6">
        <div class="bg-gradient-to-br from-[#04363a] to-[#254346] rounded-xl p-6 border border-white/10 shadow-lg hover:shadow-xl transition-all hover:scale-105">
            <div class="flex items-center justify-between mb-2">
                <div class="w-12 h-12 rounded-lg bg-[#82C293]/20 flex items-center justify-center">
                    <i class="fas fa-dollar-sign text-[#82C293] text-xl"></i>
                </div>
            </div>
            <div class="text-xs sm:text-sm text-white/60 mb-1 font-medium">Total Sales</div>
            <div class="text-2xl sm:text-3xl font-bold text-white mb-1">${{ total_revenue|floatformat:2 }}</div>
            <div class="text-xs text-white/60 mt-2">{{ total_count }} transactions</div>
        </div>
        
        <div class="bg-gradient-to-br from-[#04363a] to-[#254346] rounded-xl p-6 border border-white/10 shadow-lg hover:shadow-xl transition-all hover:scale-105">
            <div class="flex items-center justify-between mb-2">
                <div class="w-12 h-12 rounded-lg bg-[#82C293]/20 flex items-center justify-center">
                    <i class="fas fa-percentage text-[#82C293] text-xl"></i>
                </div>
            </div>
            <div class="text-xs sm:text-sm text-white/60 mb-1 font-medium">Your Commission</div>
            <div class="text-2xl sm:text-3xl font-bold text-[#82C293] mb-1">${{ commission|floatformat:2 }}</div>
            <div class="text-xs text-white/60 mt-2">
                {% if partner.commission_rate %}{{ partner.commission_rate|floatformat:0 }}% rate{% else %}20% default{% endif %}
            </div>
        </div>
        
        <div class="bg-gradient-to-br from-[#04363a] to-[#254346] rounded-xl p-6 border border-white/10 shadow-lg hover:shadow-xl transition-all hover:scale-105">
            <div class="flex items-center justify-between mb-2">
                <div class="w-12 h-12 rounded-lg bg-[#82C293]/20 flex items-center justify-center">
                    <i class="fas fa-chart-line text-[#82C293] text-xl"></i>
                </div>
            </div>
            <div class="text-xs sm:text-sm text-white/60 mb-1 font-medium">Average Sale</div>
            <div class="text-2xl sm:text-3xl font-bold text-white mb-1">${{ avg_sale|floatformat:2 }}</div>
            <div class="text-xs text-white/60 mt-2">Per transaction</div>
        </div>
    </div>
    
    <!-- Sales List -->
    <div class="bg-[#04363a]/50 backdrop-blur-sm rounded-xl p-6 sm:p-8 border border-white/10 shadow-lg">
        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6">
            <h2 class="text-lg sm:text-xl font-bold text-white flex items-center gap-2">
                <i class="fas fa-list text-[#82C293]"></i>
                Recent Sales
            </h2>
        </div>
        
        {% if payments %}
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="bg-[#254346]/50 border-b border-white/10">
                    <tr>
                        <th class="text-left py-3 px-4 text-sm font-semibold text-white">Date</th>
                        <th class="text-left py-3 px-4 text-sm font-semibold text-white">Student</th>
                        <th class="text-left py-3 px-4 text-sm font-semibold text-white">Course</th>
                        <th class="text-right py-3 px-4 text-sm font-semibold text-white">Amount</th>
                        <th class="text-right py-3 px-4 text-sm font-semibold text-white">Commission</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-white/10">
                    {% for payment in payments %}
                    <tr class="hover:bg-[#254346]/30 transition">
                        <td class="py-3 px-4 text-sm text-white/70">{{ payment.created_at|date:"M d, Y" }}</td>
                        <td class="py-3 px-4 text-sm text-white">{{ payment.user.get_full_name|default:payment.user.username }}</td>
                        <td class="py-3 px-4 text-sm text-white/80">{{ payment.course.title|default:"N/A" }}</td>
                        <td class="py-3 px-4 text-sm text-white text-right font-medium">${{ payment.amount|floatformat:2 }}</td>
                        <td class="py-3 px-4 text-sm text-[#82C293] text-right font-medium">
                            ${{ payment.commission_amount|floatformat:2 }}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="text-center py-12">
            <i class="fas fa-link text-5xl text-white/20 mb-4"></i>
            <p class="text-white/60 text-lg">No sales found</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
